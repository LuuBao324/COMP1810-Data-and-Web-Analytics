---
title: "Task2"
author: "Bao Luu"
date: "2025-06-29"
output: html_document
---

# 1. Install & Import libraries

```{r}
library(tidyverse)
library(dplyr)
library(psych)
```

# 2. Read & Understand dataset

```{r}
df2 <- read.csv("../data/diabetes.csv", 
               encoding = "latin1",
               fileEncoding = "latin1")
head(df2)

```

```{r}
cat("The number of data points: ", dim(df2)[1], "\n")
cat("The number of variables: ", dim(df2)[-1])
```

```{r}
sapply(df2, class)
```

```{r}
colSums(is.na(df2))
```

# 3. Task d

```{r}
desc_stats <- function(data_column) {
  if (is.numeric(data_column)) {
    mean_val <- mean(data_column, na.rm = TRUE)
    median_val <- median(data_column, na.rm = TRUE)
    sd_val <- sd(data_column, na.rm = TRUE)
    var_val <- var(data_column, na.rm = TRUE)
    return(c(mean = mean_val, median = median_val, standard_deviation = sd_val, variance = var_val))
  } else {
    return(c(mean = NA, median = NA, standard_deviation = NA, variance = NA))
  }
}
```

```{r}
for (col_name in names(df2)){
  cat(paste("Statistics of ", col_name, "before cleaning", "\n"))
  stat_names <- desc_stats(df2[[col_name]])
  for (stat_name in names(stat_names)) {
    cat(stat_name,":", stat_names[[stat_name]],"\n ")
  }
  cat("\n")
}

```

```{r}
describe(df2)
```

```{r}
plot_and_save_numeric_columns <- function(df, outdir = "../outputs/Task2") {
  if (!dir.exists(outdir)) {
    dir.create(outdir, recursive = TRUE)
    cat("Created folder:", outdir, "\n")
  }

  numeric_cols <- c("Pregnancies", "Glucose", "BloodPressure", "SkinThickness",
                    "Insulin", "BMI", "DiabetesPedigreeFunction", "Age")

  for (col_name in numeric_cols) {
    if (is.numeric(df[[col_name]])) {
      # File name
      file_path <- file.path(outdir, paste0(col_name, "_hist_box_before_cleaning.png"))

      # Save histogram and boxplot side-by-side
      png(file_path, width = 1000, height = 500)
      par(mfrow = c(1, 2))

      # Histogram using base R
      hist(df[[col_name]],
           main = paste("Histogram of", col_name, "(before cleaning)"),
           col = "blue",
           border = "black",
           xlab = col_name)

      # Boxplot using base R
      boxplot(df[[col_name]],
              main = paste("Boxplot of", col_name, "(before cleaning)"),
              col = "green",
              horizontal = TRUE,
              xlab = col_name)

      dev.off()
    }
  }

  cat("All plots saved to:", outdir, "\n")
}

plot_and_save_numeric_columns(df2)
```

```{r}
num_cols <- c("Pregnancies", "Glucose", "BloodPressure", "SkinThickness", "Insulin", "BMI", "DiabetesPedigreeFunction", "Age")
for (col_name in num_cols){
  plot <- ggplot(df2, aes_string(x = col_name)) +
    geom_histogram(bins = 30, fill = "blue", color = "black", alpha = 0.7) +
    labs(
      title = paste("Distribution of", col_name, "before cleaning"),
      x = col_name,
      y = "Frequency (Count)"
    ) +
    theme_light()
  
  print(plot)
}
```

```{r}
outcome_count <- table(df2$Outcome)
percentages <- round(100 * outcome_count / sum(outcome_count), 1)
pie(outcome_count, 
    labels = paste(names(outcome_count), " (", percentages,"%)", sep = ""),
    main = "Pie chart for Outcome",
    col = c("red", "green"))
```

```{r}
draw_boxplot <- function(column, title) {
  boxplot(column, main = title, horizontal = TRUE)
}

numeric_col <- c("Pregnancies", "Glucose", "BloodPressure", "SkinThickness", "Insulin", "BMI", "DiabetesPedigreeFunction", "Age")

for (col_name in numeric_col){
  if (is.numeric(df2[[col_name]])){
    title_text <- paste("Descriptive stat of", col_name, "before cleaning")
    draw_boxplot(df2[[col_name]], title = title_text)
    cat("\n")
  }
}
```

# 4. Task e

### Errors Identified in Each Column

### Glucose

-   **Problem**: 0 mg/dL is not physiologically possible

-   **Normal Range**: 70–100 mg/dL

```{r}
df2 %>% 
  filter(Glucose == 0)
```

### Blood Pressure

-   **Problem**: 0 mm Hg blood pressure is unrealistic.

-   **Normal Range**: 60–80 mm Hg.

```{r}
df2 %>% 
  filter(BloodPressure == 0)
```

### SkinThickness

-   **Problem**: 0 mm triceps skinfold is impossible.

-   **Normal Range**: 10–50 mm in adults.

```{r}
df2 %>% 
  filter(SkinThickness == 0)
```

### Insulin

-   **Problem**: 0 µU/mL is highly unlikely for serum insulin.

-   **Normal Range**: 2–25 µU/mL fasting.

```{r}
df2 %>% 
  filter(Insulin == 0)
```

### BMI

-   **Problem**: BMI = 0 means zero weight — impossible.

-   **Normal Range**: 18.5–24.9 (normal weight).

```{r}
df2 %>% 
  filter(BMI == 0)
```

```{r}
cols_to_clean <- c("Glucose", "BloodPressure", "SkinThickness", "Insulin", "BMI")
for (col in cols_to_clean) {
  df2[[col]][df2[[col]] == 0] <- NA
}

for (col in cols_to_clean) {
  df2[[col]][is.na(df2[[col]])] <- mean(df2[[col]], na.rm = TRUE)
}
```

```{r}

cleaned_desc_stats <- function(data_column) {
  if (is.numeric(data_column)) {
    mean_val <- mean(data_column, na.rm = TRUE)
    median_val <- median(data_column, na.rm = TRUE)
    sd_val <- sd(data_column, na.rm = TRUE)
    var_val <- var(data_column, na.rm = TRUE)
    return(c(mean = mean_val, median = median_val, standard_deviation = sd_val, variance = var_val))
  }
}

```

```{r}
for (col_name in cols_to_clean){
  cat(paste("Statistics of ", col_name, "after cleaning", "\n"))
  cleaned_stat_names <- cleaned_desc_stats(df2[[col_name]])
  for (stat_name in names(cleaned_stat_names)) {
    cat(stat_name,":", cleaned_stat_names[[stat_name]],"\n ")
  }
  cat("\n")
}

```

```{r}
for (col_name in cols_to_clean){
  plot <- ggplot(df2, aes_string(x = col_name)) +
    geom_histogram(bins = 30, fill = "blue", color = "black", alpha = 0.7) +
    labs(
      title = paste("Distribution of", col_name, "after cleaning"),
      x = col_name,
      y = "Frequency (Count)"
    ) +
    theme_light()
  
  print(plot)
}
```

```{r}
for (col_name in cols_to_clean){
  if (is.numeric(df2[[col_name]])){
    title_text <- paste("Descriptive statistic of", col_name, "after cleaning")
    draw_boxplot(df2[[col_name]], title = title_text)
    cat("\n")
  }
}
```

```{r}
plot_and_save_numeric_columns_after_cleaning <- function(df, outdir = "../outputs/Task2") {
  if (!dir.exists(outdir)) {
    dir.create(outdir, recursive = TRUE)
    cat("Created folder:", outdir, "\n")
  }

  cols_to_clean <- c("Glucose", "BloodPressure", "SkinThickness", "Insulin", "BMI")

  for (col_name in cols_to_clean) {
    if (is.numeric(df[[col_name]])) {
      # File name
      file_path <- file.path(outdir, paste0(col_name, "_hist_box_after_cleaning.png"))

      # Save histogram and boxplot side-by-side
      png(file_path, width = 1000, height = 500)
      par(mfrow = c(1, 2))

      # Histogram using base R
      hist(df[[col_name]],
           main = paste("Histogram of", col_name, "after cleaning)"),
           col = "blue",
           border = "black",
           xlab = col_name)

      # Boxplot using base R
      boxplot(df[[col_name]],
              main = paste("Boxplot of", col_name, "after cleaning"),
              col = "green",
              horizontal = TRUE,
              xlab = col_name)

      dev.off()
    }
  }

  cat("All plots saved to:", outdir, "\n")
}

plot_and_save_numeric_columns_after_cleaning(df2)
```
