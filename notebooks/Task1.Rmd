---
q---
title: "Task 1"
author: "Bao Luu"
date: "2025-06-29"
output: html_document
---

# Task 1

# 1. Install & Import library

```{r}
# install.packages("psych")
library(tidyverse) 
library(GGally)
library(psych)
library(scales)
library(corrplot)
```

# 2. Read & Understand the dataset

```{r}
df <- read.csv("../data/Web Analytic_Dataset.csv", 
                encoding = 'latin1', 
                fileEncoding = 'latin1' )
head(df)
```

## 2.1 The shape of dataset

```{r}
cat("The number of data points: ", dim(df)[1], "\n")
cat("The number of variables: ", dim(df)[-1])
```

**-\> Comment:** The dataset has 250 data points and 13 variables

## 2.2 Checking null value

```{r}
colSums(is.na(df))
```

## 2.3 Data Cleaning

### 2.3.1 Cleaning the column names

```{r}
df <- df %>%
  rename(
    Source_Medium = `Source...Medium`,
    Year = `Year`,
    Month_of_the_year = `Month.of.the.year`,
    Users = `Users`,
    New_Users = `New.Users`,
    Sessions = `Sessions`,
    Bounce_Rate = `Bounce.Rate`,
    Pageviews = `Pageviews`,
    Avg_Session_Duration = `Avg..Session.Duration`,
    Conversion_Rate = `Conversion.Rate....`,
    Transactions = `Transactions`,
    Revenue = `Revenue`,
    Quantity_Sold = `Quantity.Sold`
  )
str(df)
```

### 2.3.2 Cleaning data

```{r}
cols_to_clean_commas <- c("Users", "New_Users", "Sessions", "Pageviews", "Revenue", "Quantity_Sold", "Transactions")
for(col in cols_to_clean_commas) {
  df[[col]] <- as.numeric(gsub(",", "", df[[col]]))
}
```

```{r}
df <- df %>% 
  mutate(
    Bounce_Rate = as.numeric(sub("%", "", Bounce_Rate)) / 100,
    Conversion_Rate = ifelse(Conversion_Rate == "<0.01", "0", Conversion_Rate),
    Conversion_Rate = as.numeric(Conversion_Rate),
    Avg_Session_Duration = as.numeric(hms(Avg_Session_Duration))
  )
str(df)

```

# 3. Task a:

## 3.1 Identify Top 3 Sources based on Revenue

```{r}
# Group by Source_Medium and Year to get total revenue
revenue_by_source <- df %>%
  group_by(Source_Medium, Year) %>%
  summarise(Total_Revenue = sum(Revenue, na.rm = TRUE)) %>%
  ungroup()

# Find out the top 3 sources based on revenue
top_3_sources <- df %>%
  group_by(Source_Medium) %>%
  summarise(Grand_Total_Revenue = sum(Revenue, na.rm = TRUE)) %>%
  arrange(desc(Grand_Total_Revenue)) %>%
  slice_head(n = 3) %>%
  pull(Source_Medium)

revenue_by_source

```

```{r}
# Filter the summary table for only the top 3 sources
top_3_revenue_table <- revenue_by_source %>%
  filter(Source_Medium %in% top_3_sources) %>%
  pivot_wider(names_from = Year, values_from = Total_Revenue, values_fill = 0)

top3_revenue <- df %>% filter(Source_Medium %in% top_3_sources) %>% group_by(Year, Source_Medium) %>% summarise(TotalRevenue = sum(Revenue), .groups = "drop")
top3_revenue

top_3_revenue_table

```

## 3.2 Chart to visualize the top three and revenue for each year

```{r}
chart_data <- revenue_by_source %>%
  filter(Source_Medium %in% top_3_sources)

ggplot(chart_data, aes(x = factor(Year), y = Total_Revenue, fill = Source_Medium)) + 
  geom_bar(stat = "identity",position = "dodge") + 
  geom_text(
    aes(label = dollar(Total_Revenue, accuracy = 1)),
    position = position_dodge(width = 0.9), 
    vjust = -0.5,
    size = 3.5 
  ) +
  scale_fill_manual(values = c("green", "red", "blue")) + 
  scale_y_continuous(labels = dollar_format()) +
  labs( title = "Top 3 Traffic Sources by Revenue for each year", 
        x = "Year", 
        y = "Revenue", 
        fill = "Source_Medium" ) + theme_minimal()
```

The table and bar chart in compare 3 of the top traffic sourcesÂ  A, B, and S based on revenue in 2019 and 2020. Source A produced the most revenue in both 2019 and 2020, and it had a great increase from \$335,498 in 2019 to \$958,638 in 2020, showing the strongest and increasing impact on the revenue of the business.

Source S, comparatively, had a good increase from \$167,526 in 2019 to \$551,656 in 2020 suggesting better engagement or performance in what they were marketing or user engagement with that channel. Source B, on the other hand, increased in revenue, but more modestly from \$191,107 to \$349,585. In fact, in 2020, Source S surpassed Source B in revenue.

These differences can be visually appreciated in the bar chart. Source A remains on top, but B and S fluctuated in their position and impact over time. Considering the above, Source A should remain the prioritization for revenue as the marketing and traffic strategies aim to drive more engagement. Source S is an area of opportunity and further investment could earn greater revenue. Source B has not grown at a greater pace when compared to both A and S and may need to be reconsidered.

# 4. Task b:

```{r}
source_user_summary <- df %>%
  group_by(Source_Medium) %>%
  summarise(
    Total_Users = sum(Users, na.rm = TRUE),
    Total_New_Users = sum(New_Users, na.rm = TRUE)
  ) %>%
  arrange(desc(Total_Users))

grouped_user <- source_user_summary %>%
  pivot_longer(c(Total_Users, Total_New_Users),
               names_to = "User_Type",
               values_to = "Count")

ggplot(grouped_user, aes(x = reorder(Source_Medium, -Count), y = Count, fill = User_Type)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_y_continuous(labels = label_comma()) +
  labs(title = "Total Users and New Users by Source/Medium",
       x = "Source/Medium",
       y = "Count") +
  scale_fill_manual(values = c("Total_Users" = "orange", "Total_New_Users" = "lightblue"),
                    labels = c("Total Users", "Total New Users")) +
  theme_minimal() +
  coord_flip()
```

Source A has the most users overall, followed by B and C. All three also have a lot of new users. Most of the time, the number of new users is very near to the overall number of users, which means that a lot of people are coming to the site for the first time. Sources with lower rankings bring in a lot fewer visitors, which means they do not have as much of an effect on overall traffic and might not be the best channels for growth.

```{r}

top5sources <- df %>% 
  group_by(Source_Medium) %>%
  summarise(AvgConversionRate = mean(Conversion_Rate, na.rm = TRUE)) %>%
  arrange(desc(AvgConversionRate)) %>%
  slice_head(n = 5) %>%
  pull(Source_Medium)

linecharttop5 <- df %>%
  filter(Source_Medium %in% top5sources)



ggplot(linecharttop5, aes(x = YearMonth, y = Conversion_Rate, color = Source_Medium)) + 
  geom_line(linewidth = 1.2) + 
  geom_point(size = 1.2) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b%y") +
  labs(
    title = "Top 5",
    x = "Month and Year",
    y = "Conversion Rate",
    color = "Source/Medium"
  ) + theme_minimal() +
  theme(
    legend.position = "right",
    axis.text.x = element_text(angle = 45, hjust = 1),
  
  )


```

```{r}
grouped_user
source_user_summary
```

```{r}
df$YearMonth <- as.Date(paste(df$Year, df$Month_of_the_year, "01", sep = "-"), "%Y-%m-%d")

all_sources <- df %>%
  group_by(Source_Medium) %>%
  summarise(Avg_Conversion_Rate = mean(Conversion_Rate, na.rm = TRUE)) %>%
  arrange(desc(Avg_Conversion_Rate)) %>%
  slice_head(n = 38) %>%
  pull(Source_Medium)

top_20_sources <- all_sources[1:20]
next_18_sources <- all_sources[21:38]

top_20_data <- df %>% filter(Source_Medium %in% top_20_sources)
next_18_data <- df %>% filter(Source_Medium %in% next_20_sources)

top_20_data
next_18_data
```

```{r}
distinct_colors <- c("#e6194B", "#3cb44b", "#ffe119", "#4363d8", "#f58231", "#911eb4", "#42d4f4", "#f032e6", 
  "#bcf60c", "#fabebe", "#008080", "#e6beff", "#9A6324", "#fffac8", "#800000", "#aaffc3", 
  "#808000", "#ffd8b1", "#000075", "#a9a9a9")

ggplot(top_20_data, aes(x = YearMonth, y = Conversion_Rate, color = Source_Medium, group = Source_Medium)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2.5) +  
  scale_x_date(date_breaks = "1 months", date_labels = "%b %Y") +
  scale_color_manual(values = distinct_colors) +
  labs(
    title = "Monthly Conversion Rate for Top 1-20 Sources",
    subtitle = "Comparing user trends for the highest performers (2019-2020)",
    x = "Month and Year",
    y = "Conversion Rate (%)",
    color = "Source / Medium"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )

```

Source S stands out dominantly with an extraordinarily high and stable average conversion rate of over 33% for the measured period. Source U was a distant second with an average of around 22.86%. It does change a little from month to month, but it still does far better than the others. CC and EE were mid-range with CC showing a small decline and EE staying stable. Source DD is ranked fifth yet is underperforming well below the expected value with under a 2% average rate. Giving its rank, DD is not a high impact source and is ranked for the sake of being ranked. The rest of the sources have very little conversion activity, mostly below 1%. Collectively, the data is extremely skewed, with only the two top channels significantly contributing all the conversion activity while most of the other channels, including DD may need to be re-evaluated or re-examination to assess if the conversion performance can reasonably be improved.

```{r}
ggplot(next_18_data, aes(x = YearMonth, y = Conversion_Rate, color = Source_Medium, group = Source_Medium)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2.5) +  
  scale_x_date(date_breaks = "1 months", date_labels = "%b %Y") +
  scale_color_manual(values = distinct_colors) + 
  labs(
    title = "Monthly Conversion Rate for Top 21-38 Sources",
    subtitle = "Comparing user trends for the highest performers (2019-2020)",
    x = "Month and Year",
    y = "Conversion Rate (%)",
    color = "Source / Medium"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )
```

the conversion rates for numbers 21 to 38 are really poor as they do not stay the same. They are usually below 1% and only go up for a short time because of inconsistent marketing efforts or transient marketing techniques. Source K, on the other hand, seems to be on a gradual but steady path, which suggests that it could get a lot better with consistent effort. Other sources, like B, C, and I.K, show strong, erratic spikes and severe drops, which means that user involvement is very low or only happens on a few occasions. Some sources, like euromessage/push and D, do not alter much from month to month. This means they do not have much of an effect and shouldn't be given much priority. Overall, these sources are less reliable and less effective at converting than the top twenty. However, some, like K, B, or C, stand out and can be worth more attention or invest in because they are growing consistently.

# 5. Task c:

```{r}
relationship_df <- df %>%
  select(Bounce_Rate, Conversion_Rate, Transactions, Revenue)

correlation_matrix <- cor(relationship_df)

correlation_matrix
```

```{r}
corrplot(correlation_matrix,
         method = "color",
         type = "full",
         addCoef.col = "black", 
         tl.col = "black",      
         tl.srt = 45,  
         tl.cex = 0.8,
         main = "Correlation Heatmap of Key Metrics",
         mar = c(0,0,1,0))
```

Using Pearson correlation values, the correlation heatmap shows how Bounce Rate, Conversion Rate, Transactions, and Revenue are related to each other. Transactions and revenue have the strongest correlation, with a value of 0.98, which means that there is a very close and consistent positive relationship between the two. This means that increasing the number of transactions will almost certainly lead to higher revenue, so transaction volume is a key area to focus on for revenue growth. There is a moderate correlation between Conversion Rate and Revenue (0.35), which shows a weak but noticeable positive trend. However, the change in revenue with conversion rate is small, so improving conversion may help, but it may not be enough to make a big difference in revenue on its own. There is also a 0.30 correlation between Conversion Rate and Transactions, which means that better conversion rates usually lead to more purchases. However, this relationship is not very strong, so improvements may not always lead to big gains. There is a moderate negative correlation between Bounce Rate and Conversion Rate at -0.47. This means that as more people leave the site quickly, fewer conversions happen. This means that lowering the bounce rate could help raise the conversion rate, but only if it is done with other improvements. The correlation between Bounce Rate and Transactions is very low at 0.04, which means there is almost no connection between the two. This means that trying to lower the bounce rate is not likely to directly lead to more transactions. The relationship between Bounce Rate and Revenue is also very weak, with a correlation of only 0.02. This means that bounce rate by itself doesn't have much of an effect on overall revenue.

```{r}
# Bounce Rate vs Conversion Rate
ggplot(relationship_df, aes(x = Bounce_Rate, y = Conversion_Rate )) +
  geom_point(color = "blue") +
  geom_smooth(method = "lm",color = "black", se = FALSE ) + 
  labs(
    title = "Relationship between Bounce Rate and Conversion Rate",
    x = "Bounce_Rate",
    y = "Conversion_Rate"
  ) + theme_minimal()

```

The scatter plot shows that there is a negative relationship between Bounce Rate and Conversion Rate. In other words, higher bounce rates tend to mean lower conversion rates. The downward-sloping regression line backs up this trend, even though the data points are a bit spread out. The correlation isn't very strong, but it's still there. This means that users who leave the site quickly are less likely to convert. This means that making landing pages more relevant, faster, or better designed can help lower the bounce rate, which can lead to better conversion rates.

```{r}
# Conversion Rate vs Transactions
ggplot(relationship_df, aes(x = Conversion_Rate, y = Transactions )) +
  geom_point(color = "green") +
  geom_smooth(method = "lm",color = "black", se = FALSE ) + 
  labs(
    title = "Relationship between Conversion Rate and Transactions",
    x = "Conversion_Rate",
    y = "Transactions"
  ) + theme_minimal()
```

The regression line going upwards shows that there is a weak positive relationship between the Conversion Rate and Transactions. Most of the data points are close to low conversion rates, but there are a few that are higher. More transactions may happen when conversion rates are higher, but the link is not strong. This means that raising the conversion rate might help boost sales, but other things, like the number of visitors and their intentions, are also very important.

```{r}
# Transactions vs Revenue
ggplot(relationship_df, aes(x = Transactions, y = Revenue)) +
  geom_point(color = "red") +
  geom_smooth(method = "lm", color = "black", se = FALSE) + 
  labs(
    title = "Relationship between Transactions and Revenue",
    x = "Transactions",
    y = "Revenue"
  ) +
  theme_minimal()
```

The scatter plot shows a strong positive linear relationship between transactions and revenue. The data points are very close to the line, which shows that the two variables are almost perfectly related. As the number of transactions goes up, revenue goes up as well. This is shown by the heatmap's correlation coefficient of 0.98. This pattern shows that one of the best ways to make more money is to do more transactions. From a business point of view, this information shows how important it is to use strategies that lead to more completed purchases, such as improving the user journey better, speeding up the checkout process, and providing targeted promotions. Because the relationship is strong and straight, even small increases in transactions are likely to lead to big increases in revenue.

```{r}
# Bounce_rate vs Revenue
ggplot(relationship_df, aes(x = Bounce_Rate, y = Revenue )) +
  geom_point(color = "dodgerblue") +
  geom_smooth(method = "lm",color = "black", se = FALSE ) + 
  labs(
    title = "Relationship between Bounce Rate and Revenue",
    x = "Bounce_Rate",
    y = "Revenue"
  ) + theme_minimal()
```

The regression line is nearly horizontal, and the data points are spread out demonstrating the no connection between Bounce Rate and Revenue. There is no clearly demonstrated pattern to indicate that any change in the bounce rate has a commensurate effect on revenue. This is consistent with the heatmap correlation value of 0.02 indicating that bounce rate has little effect on revenue. Therefore, instead of trying to do things merely to reduce the bounce rate as a goal, the aim of increasing revenue should focus elsewhere on things to boost such as transactions per user, or conversion rate.

```{r}
# Conversion_Rate vs Revenue
ggplot(relationship_df, aes(x = Conversion_Rate, y = Revenue )) +
  geom_point(color = "purple") +
  geom_smooth(method = "lm",color = "black", se = FALSE ) + 
  labs(
    title = "Relationship between Conversion Rate and Revenue",
    x = "Conversion_Rate",
    y = "Revenue"
  ) + theme_minimal()
```

The regression line is positively sloping, and the spread of the data points indicate a weak positive relationship between Conversion Rate and Revenue. Higher conversion rates may make some money more likely, but the effects are not always strong or consistent. This supports the correlation coefficient of 0.35, which is quite small. The insight is that raising the conversion rate may increase sales, but it should be used in conjunction with other strategies to raise sales, like boosting more traffic or increasing transactions.

```{r}
ggplot(relationship_df, aes(x = Bounce_Rate, y = Transactions )) +
  geom_point(color = "darkgreen") +
  geom_smooth(method = "lm",color = "black", se = FALSE ) + 
  labs(
    title = "Relationship between Bounce Rate and Transactions",
    x = "Bounce_Rate",
    y = "Transactions"
  ) + theme_minimal()
```

The scatter plot doesn't show a clear link between Bounce Rate and Transactions because the data points are spread out and the regression line is almost flat. This fits with the very low correlation coefficient of 0.04. This means that changes in bounce rate do not have much of an effect on the number of transactions. The main point here is that just trying to lower the bounce rate is not likely to lead to more transactions.

```{r}
save_correlation_and_scatter_plots <- function(df, outdir = "../outputs/Task1") {
  # Create the output directory if it doesn't exist
  if (!dir.exists(outdir)) {
    dir.create(outdir, recursive = TRUE)
    cat("Created folder:", outdir, "\n")
  }

  # 1. Correlation Heatmap
  cat("Generating and saving correlation heatmap...\n")
  relationship_df <- df %>%
  select(Bounce_Rate, Conversion_Rate, Transactions, Revenue)
  correlation_matrix <- cor(relationship_df, use = "complete.obs")
  file_path_corr <- file.path(outdir, "Correlation_Heatmap.png")

  png(file_path_corr, width = 800, height = 800)
  corrplot(correlation_matrix,
           method = "color",
           type = "full",
           addCoef.col = "black",
           tl.col = "black",
           tl.srt = 45,
           tl.cex = 0.8,
           main = "Correlation Heatmap of Key Metrics",
           mar = c(0, 0, 1, 0))
  dev.off()

  # 2. Scatterplots
  cat("Generating and saving scatterplots...\n")

  # Define plots and their filenames
  plot_list <- list(
    Bounce_vs_Conversion = ggplot(df, aes(x = Bounce_Rate, y = Conversion_Rate)) +
      geom_point(color = "blue") + geom_smooth(method = "lm", color = "black", se = FALSE) +
      labs(title = "Bounce Rate vs. Conversion Rate"),
    
    Conversion_vs_Transactions = ggplot(df, aes(x = Conversion_Rate, y = Transactions)) +
      geom_point(color = "green") + geom_smooth(method = "lm", color = "black", se = FALSE) +
      labs(title = "Conversion Rate vs. Transactions"),

    Transactions_vs_Revenue = ggplot(df, aes(x = Transactions, y = Revenue)) +
      geom_point(color = "red") + geom_smooth(method = "lm", color = "black", se = FALSE) +
      labs(title = "Transactions vs. Revenue"),

    Bounce_vs_Revenue = ggplot(df, aes(x = Bounce_Rate, y = Revenue)) +
      geom_point(color = "dodgerblue") + geom_smooth(method = "lm", color = "black", se = FALSE) +
      labs(title = "Bounce Rate vs. Revenue"),

    Conversion_vs_Revenue = ggplot(df, aes(x = Conversion_Rate, y = Revenue)) +
      geom_point(color = "purple") + geom_smooth(method = "lm", color = "black", se = FALSE) +
      labs(title = "Conversion Rate vs. Revenue"),

    Bounce_vs_Transactions = ggplot(df, aes(x = Bounce_Rate, y = Transactions)) +
      geom_point(color = "darkgreen") + geom_smooth(method = "lm", color = "black", se = FALSE) +
      labs(title = "Bounce Rate vs. Transactions")
  )

  # Loop through the list to save each plot
  for (plot_name in names(plot_list)) {
    file_path_scatter <- file.path(outdir, paste0(plot_name, "_Scatterplot.png"))
    png(file_path_scatter, width = 600, height = 500)
    # IMPORTANT: You must explicitly print a ggplot object when saving inside a function or loop
    print(plot_list[[plot_name]] + theme_minimal())
    dev.off()
  }

  cat("All correlation and scatter plots saved to:", outdir, "\n")
}
```

```{r}
save_correlation_and_scatter_plots(df)
```

```{r}
meanRevenue <- sum(df$Revenue) / length(df$Revenue)
meanRevenue


revenueSort <- sort(df$Revenue)
n <- length(revenueSort)
if (n %% 2 == 1) {
  medianVal <- revenueSort[n+1/2]
} else {
  medianVal <- revenueSort[((n/2) + (n/2+1)) /2]
}
medianVal
```

\
